# 1.进程、线程基础知识

## 1.1 进程

进程是什么
> 运行中的程序

中断是什么
> CPU可以从进程1切换到进程2，记录进程1当前状态，要恢复执行进程1就需要向CPU发送中断

并行和并发的区别
> 并行：同一时刻，进行多个任务。
> 并发：同一时间段，进行多个任务，切换频率很高让人无法感受到中断。

## 1.1.1 进程的状态

一个进程的**活动期间**至少具备三种基本状态，
> 运行状态（Running），该时刻进程占用CPU
> 就绪状态（Ready），可运行，由于其他进程处于运行状态而暂时停止运行
> 阻塞状态（Blocked），该进程正在等待某一事件完成（比如IO操作）而暂时停止运行，这时即使给它CPU控制权也无法运行。

进程的另外两个基本状态：
> 创建状态（new），进程正在被创建时的状态
> 结束状态（Exit），进程正在从系统中消失时的状态

完整的进程状态变迁：
- null→创建状态：new创建状态，
- 创建状态→就绪状态：创建完成并初始化后，进入就绪队列，等待被CPU调度，
- 就绪状态→运行状态：被CPU调度，进入运行状态，
- 运行状态→就绪状态：当前时间片完则回到就绪状态，让给下一个进程运行
- 运行状态→阻塞状态：若需要等待事件，例如IO，则进入阻塞状态，
- 阻塞状态→就绪状态：事件完成则进入就绪状态，
- 运行状态→结束状态：若进程完成或出错，则进入结束状态

挂起状态 为什么产生、是什么意思、有什么作用
> 如果有大量处于阻塞状态的进程，这些进程会占用物理内存空间，极大的浪费了物理内存。
> 所以，在虚拟内存管理的操作系统中，通常把阻塞状态的进程的物理内存空间换出到硬盘，再次运行的时候，再从硬盘换入到物理内存。
> 挂起状态：描述进程没有占用实际的物理内存空间的情况

挂起状态分为两种：
> 阻塞挂起状态：进程在外存并等待某个事件的出现
> 就绪挂起状态：进程在外存，但只要进入内存，就立刻运行

还有两种情况也会导致进程挂起：
> 通过sleep让进程间歇性挂起，原理是设置一个定时器，到期后唤醒进程。
> 用户希望挂起一个程序的执行，例如Linux中用`Ctrl+z`挂起进程

### 1.1.2 进程的控制结构

OS使用进程控制块（process control block，PCB）数据结构来描述进程。
PCB是进程存在的唯一标识

PCB包含什么？
> 进程描述信息
> 进程控制和管理信息
> 资源分配清单
> CPU相关信息

每个PCB是如何组织的
> 通常通过**链表**的方式进行组织，把具有**相同状态的进程链在一起，组成各种队列**。

### 1.1.3 进程的控制

进程的**创建、终止、阻塞、唤醒**的过程
> 创建进程
> 终止进程
> 阻塞进程
> 唤醒进程

### 1.1.4 进程的上下文切换
一个进程切换到另一个进程运行，称为进程的上下文切换。

CPU上下文切换
> CPU在运行任何任务前，必须依赖CPU寄存器和程序计数器。CPU寄存器和程序计数器就叫做CPU上下文
> CPU上下文切换：先把当前任务的CPU上下文保存起来，然后加载新任务的上下文，再跳转到程序计数器所指的新位置，运行新任务。系统内核会存储保持下来的上下文信息，当此任务再次被分配给CPU运行时，CPU会重新加载这些上下文，这样就能保证任务原来的状态不受影响，让任务看起来还是连续运行。
> CPU上下文按任务的种类，可以分成：进程上下文切换、线程上下文切换和中断上下文切换。

进程上下文切换 切换什么？
> 进程的上下文切换不仅包含了虚拟内存、栈、全局变量等用户空间的资源，还包括了内核堆栈、寄存器等内核空间的资源。
>

发生进程上下文切换的场景有哪些？




## 1.2 线程


## 1.3 调度

# 2.进程间有哪些通信方式

## 2.1 管道


## 2.2 消息队列


## 2.3 共享内存


## 2.4 信号量


## 2.5 信号


## 2.6 Socket


## 2.7 总结


# 3.多线程冲突了怎么办

## 3.1 竞争与协作


## 3.2 互斥与同步的实现和使用



## 3.3 经典同步问题



# 4.怎么避免死锁

## 4.1 死锁的概念


## 4.2 模拟死锁问题的产生

## 4.3 利用工具排查死锁问题


## 4.4 避免死锁问题的发生

## 4.5总结

# 5.什么是悲观锁、乐观锁

## 5.1 互斥锁与自旋锁

## 5.2 读写锁

## 5.3 乐观锁与悲观锁

## 5.4 总结

# 6.一个进程最多可以创建多少个线程

# 7.线程崩溃了，进程也会崩溃吗

## 7.1 线程崩溃，进程一定会崩溃吗

## 7.2 进程是如何崩溃的——信号机制

## 7.3 为什么线程崩溃不会导致JVM进程崩溃

## 7.4 openJDK 源码解析